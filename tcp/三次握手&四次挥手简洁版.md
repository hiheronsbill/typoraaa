

#### 1、tcp三次握手

TCP/IP协议是传输层的一个面向连接的安全可靠的传输协议，三次握手的机制是保证能建立一个安全可靠的连接。那么第一次握手是由客户端发起，客户端会向服务端发送一个报文，在报文里SYN=1，当服务端收到这个报文之后，就知道客户端要和自己发起一个新的连接，于是，服务端就会向客户端发送一个确认消息报，这个消息报文ACK=1，以上两次握手之后，对于客户端来说已经知道，自己既能给服务端发消息，也能收到服务端发的消息，但是对服务端来说，两次握手是不够的，因为，到目前为止，服务端只知道一件事，客户端发给我的消息我能收到，我发给客户端的消息能不能收到？还不能确认，所以还需要进行第三次握手，当客户端收到服务端发来的确认消息报文之后，还要继续给服务端发消息确认，也是一个ACK=1的确认消息报，通过以上三次连接，不管是客户端还是服务端，都能互相确认可以收到对法发送的消息，那么这个连接可以被安全的建立。

![](.images/tcp.png)



#### 2、四次挥手

四次挥手也是客户端发起的，客户端会发送一个报文，报文中FIN=1，当服务端收到这个报文之后，就知道了客户端想要和自己断开连接，但此时服务端不一定做好准备，因为当客户端发起断开连接的报文的时候，服务端有可能还有未发送完的报文消息需要继续发送，所以此时服务端只能告诉客户端我知道你要和我断开连接了，但是我这里可能还没做好准备，需要等我一下，等会我会告诉你，于是，发完这个消息确认报之后，稍过片刻服务端继续发送一个断开连接的报文，FIN=1，表明服务端已经做好断开连接的准备，那么，当这个消息发给客户端的时候，客户端同样需要继续发送一个消息确认的报文，那么通过这四次的沟通和连接，双方都已经知道对方做好了断开的准备。



